#include <stdio.h>
#include <stdint.h>
#include <string.h>

#define NUM_SHAPES 8

struct solution_t {
    uint64_t board;   /* board bitmap */
    int blocks;       /* number of used block pieces used */
    int blocks_used;  /* bitmap of used block pieces used */
    uint64_t block_masks_list[10]; // board constraint x1, date x1, blocks x8
};

struct block_shape_meta_t {
    int offset;       /* offset in block_shape LUT */
    int count;        /* number of shapes in the table */
};

/* chroodinate -> bitmap expression LUT */
#define UNROLL_MAT2BIN_LUT 1
#ifdef UNROLL_MAT2BIN_LUT
uint64_t mat2bin_lut[49] = {
#else
uint64_t mat2bin_lut[7][7] = {
    {
#endif
        0x8000000000000000, 0x4000000000000000, 0x2000000000000000,
        0x1000000000000000, 0x0800000000000000, 0x0400000000000000,
        0x0200000000000000
#ifdef UNROLL_MAT2BIN_LUT
        ,
#else
    },
    {
#endif
        0x0080000000000000, 0x0040000000000000, 0x0020000000000000,
        0x0010000000000000, 0x0008000000000000, 0x0004000000000000,
        0x0002000000000000
#ifdef UNROLL_MAT2BIN_LUT
        ,
#else
    },
    {
#endif
        0x0000800000000000, 0x0000400000000000, 0x0000200000000000,
        0x0000100000000000, 0x0000080000000000, 0x0000040000000000,
        0x0000020000000000
#ifdef UNROLL_MAT2BIN_LUT
        ,
#else
    },
    {
#endif
        0x0000008000000000, 0x0000004000000000, 0x0000002000000000,
        0x0000001000000000, 0x0000000800000000, 0x0000000400000000,
        0x0000000200000000
#ifdef UNROLL_MAT2BIN_LUT
        ,
#else
    },
    {
#endif
        0x0000000080000000, 0x0000000040000000, 0x0000000020000000,
        0x0000000010000000, 0x0000000008000000, 0x0000000004000000,
        0x0000000002000000
#ifdef UNROLL_MAT2BIN_LUT
        ,
#else
    },
    {
#endif
        0x0000000000800000, 0x0000000000400000, 0x0000000000200000,
        0x0000000000100000, 0x0000000000080000, 0x0000000000040000,
        0x0000000000020000
#ifdef UNROLL_MAT2BIN_LUT
        ,
#else
    },
    {
#endif
        0x0000000000008000, 0x0000000000004000, 0x0000000000002000,
        0x0000000000001000, 0x0000000000000800, 0x0000000000000400,
        0x0000000000000200
#ifdef UNROLL_MAT2BIN_LUT
};
#else
    }
};
#endif


struct block_shape_meta_t block_shape_meta[] = {
    {
        .offset = 0,
        .count = 192,
    },
    {
        .offset = 192,
        .count = 100,
    },
    {
        .offset = 292,
        .count = 120,
    },
    {
        .offset = 412,
        .count = 100,
    },
    {
        .offset = 512,
        .count = 192,
    },
    {
        .offset = 704,
        .count = 192,
    },
    {
        .offset = 896,
        .count = 60,
    },
    {
        .offset = 956,
        .count = 240,
    }
};


uint64_t block_shape_lut[] = {
    0x0000000000061c00, 0x00000000000c3800, 0x00000000000e1800, 0x0000000000180e00, 
    0x0000000000187000, 0x00000000001c0600, 0x00000000001c3000, 0x0000000000301c00, 
    0x000000000030e000, 0x0000000000380c00, 0x0000000000386000, 0x0000000000603800, 
    0x0000000000701800, 0x000000000070c000, 0x0000000000c07000, 0x0000000000e03000, 
    0x00000000061c0000, 0x000000000c380000, 0x000000000e180000, 0x00000000180e0000, 
    0x0000000018700000, 0x000000001c060000, 0x000000001c300000, 0x00000000301c0000, 
    0x0000000030e00000, 0x00000000380c0000, 0x0000000038600000, 0x0000000060380000, 
    0x0000000070180000, 0x0000000070c00000, 0x00000000c0700000, 0x00000000e0300000, 
    0x0000000202060400, 0x0000000206040400, 0x0000000404060200, 0x00000004040c0800, 
    0x0000000406020200, 0x000000040c080800, 0x000000061c000000, 0x00000008080c0400, 
    0x0000000808181000, 0x000000080c040400, 0x0000000818101000, 0x0000000c38000000, 
    0x0000000e18000000, 0x0000001010180800, 0x0000001010302000, 0x0000001018080800, 
    0x0000001030202000, 0x000000180e000000, 0x0000001870000000, 0x0000001c06000000, 
    0x0000001c30000000, 0x0000002020301000, 0x0000002020604000, 0x0000002030101000, 
    0x0000002060404000, 0x000000301c000000, 0x00000030e0000000, 0x000000380c000000, 
    0x0000003860000000, 0x0000004040602000, 0x0000004040c08000, 0x0000004060202000, 
    0x00000040c0808000, 0x0000006038000000, 0x0000007018000000, 0x00000070c0000000, 
    0x0000008080c04000, 0x00000080c0404000, 0x000000c070000000, 0x000000e030000000, 
    0x0000020206040000, 0x0000020604040000, 0x0000040406020000, 0x000004040c080000, 
    0x0000040602020000, 0x0000040c08080000, 0x0000061c00000000, 0x000008080c040000, 
    0x0000080818100000, 0x0000080c04040000, 0x0000081810100000, 0x00000c3800000000, 
    0x00000e1800000000, 0x0000101018080000, 0x0000101030200000, 0x0000101808080000, 
    0x0000103020200000, 0x0000180e00000000, 0x0000187000000000, 0x00001c0600000000, 
    0x00001c3000000000, 0x0000202030100000, 0x0000202060400000, 0x0000203010100000, 
    0x0000206040400000, 0x0000301c00000000, 0x000030e000000000, 0x0000380c00000000, 
    0x0000386000000000, 0x0000404060200000, 0x00004040c0800000, 0x0000406020200000, 
    0x000040c080800000, 0x0000603800000000, 0x0000701800000000, 0x000070c000000000, 
    0x00008080c0400000, 0x000080c040400000, 0x0000c07000000000, 0x0000e03000000000, 
    0x0002020604000000, 0x0002060404000000, 0x0004040602000000, 0x0004040c08000000, 
    0x0004060202000000, 0x00040c0808000000, 0x00061c0000000000, 0x0008080c04000000, 
    0x0008081810000000, 0x00080c0404000000, 0x0008181010000000, 0x000c380000000000, 
    0x000e180000000000, 0x0010101808000000, 0x0010103020000000, 0x0010180808000000, 
    0x0010302020000000, 0x00180e0000000000, 0x0018700000000000, 0x001c060000000000, 
    0x001c300000000000, 0x0020203010000000, 0x0020206040000000, 0x0020301010000000, 
    0x0020604040000000, 0x00301c0000000000, 0x0030e00000000000, 0x00380c0000000000, 
    0x0038600000000000, 0x0040406020000000, 0x004040c080000000, 0x0040602020000000, 
    0x0040c08080000000, 0x0060380000000000, 0x0070180000000000, 0x0070c00000000000, 
    0x008080c040000000, 0x0080c04040000000, 0x00c0700000000000, 0x00e0300000000000, 
    0x0202060400000000, 0x0206040400000000, 0x0404060200000000, 0x04040c0800000000, 
    0x0406020200000000, 0x040c080800000000, 0x061c000000000000, 0x08080c0400000000, 
    0x0808181000000000, 0x080c040400000000, 0x0818101000000000, 0x0c38000000000000, 
    0x0e18000000000000, 0x1010180800000000, 0x1010302000000000, 0x1018080800000000, 
    0x1030202000000000, 0x180e000000000000, 0x1870000000000000, 0x1c06000000000000, 
    0x1c30000000000000, 0x2020301000000000, 0x2020604000000000, 0x2030101000000000, 
    0x2060404000000000, 0x301c000000000000, 0x30e0000000000000, 0x380c000000000000, 
    0x3860000000000000, 0x4040602000000000, 0x4040c08000000000, 0x4060202000000000, 
    0x40c0808000000000, 0x6038000000000000, 0x7018000000000000, 0x70c0000000000000, 
    0x8080c04000000000, 0x80c0404000000000, 0xc070000000000000, 0xe030000000000000, 
    0x00000000020e0800, 0x00000000041c1000, 0x0000000006040c00, 0x00000000080e0200, 
    0x0000000008382000, 0x000000000c040600, 0x000000000c081800, 0x00000000101c0400, 
    0x0000000010704000, 0x0000000018080c00, 0x0000000018103000, 0x0000000020380800, 
    0x0000000020e08000, 0x0000000030101800, 0x0000000030206000, 0x0000000040701000, 
    0x0000000060203000, 0x000000006040c000, 0x0000000080e02000, 0x00000000c0406000, 
    0x000000020e080000, 0x000000041c100000, 0x00000006040c0000, 0x000000080e020000, 
    0x0000000838200000, 0x0000000c04060000, 0x0000000c08180000, 0x000000101c040000, 
    0x0000001070400000, 0x00000018080c0000, 0x0000001810300000, 0x0000002038080000, 
    0x00000020e0800000, 0x0000003010180000, 0x0000003020600000, 0x0000004070100000, 
    0x0000006020300000, 0x0000006040c00000, 0x00000080e0200000, 0x000000c040600000, 
    0x0000020e08000000, 0x0000041c10000000, 0x000006040c000000, 0x0000080e02000000, 
    0x0000083820000000, 0x00000c0406000000, 0x00000c0818000000, 0x0000101c04000000, 
    0x0000107040000000, 0x000018080c000000, 0x0000181030000000, 0x0000203808000000, 
    0x000020e080000000, 0x0000301018000000, 0x0000302060000000, 0x0000407010000000, 
    0x0000602030000000, 0x00006040c0000000, 0x000080e020000000, 0x0000c04060000000, 
    0x00020e0800000000, 0x00041c1000000000, 0x0006040c00000000, 0x00080e0200000000, 
    0x0008382000000000, 0x000c040600000000, 0x000c081800000000, 0x00101c0400000000, 
    0x0010704000000000, 0x0018080c00000000, 0x0018103000000000, 0x0020380800000000, 
    0x0020e08000000000, 0x0030101800000000, 0x0030206000000000, 0x0040701000000000, 
    0x0060203000000000, 0x006040c000000000, 0x0080e02000000000, 0x00c0406000000000, 
    0x020e080000000000, 0x041c100000000000, 0x06040c0000000000, 0x080e020000000000, 
    0x0838200000000000, 0x0c04060000000000, 0x0c08180000000000, 0x101c040000000000, 
    0x1070400000000000, 0x18080c0000000000, 0x1810300000000000, 0x2038080000000000, 
    0x20e0800000000000, 0x3010180000000000, 0x3020600000000000, 0x4070100000000000, 
    0x6020300000000000, 0x6040c00000000000, 0x80e0200000000000, 0xc040600000000000, 
    0x00000000000a0e00, 0x00000000000e0a00, 0x0000000000141c00, 0x00000000001c1400, 
    0x0000000000283800, 0x0000000000382800, 0x0000000000507000, 0x0000000000705000, 
    0x0000000000a0e000, 0x0000000000e0a000, 0x0000000006020600, 0x0000000006040600, 
    0x000000000a0e0000, 0x000000000c040c00, 0x000000000c080c00, 0x000000000e0a0000, 
    0x00000000141c0000, 0x0000000018081800, 0x0000000018101800, 0x000000001c140000, 
    0x0000000028380000, 0x0000000030103000, 0x0000000030203000, 0x0000000038280000, 
    0x0000000050700000, 0x0000000060206000, 0x0000000060406000, 0x0000000070500000, 
    0x00000000a0e00000, 0x00000000c040c000, 0x00000000c080c000, 0x00000000e0a00000, 
    0x0000000602060000, 0x0000000604060000, 0x0000000a0e000000, 0x0000000c040c0000, 
    0x0000000c080c0000, 0x0000000e0a000000, 0x000000141c000000, 0x0000001808180000, 
    0x0000001810180000, 0x0000001c14000000, 0x0000002838000000, 0x0000003010300000, 
    0x0000003020300000, 0x0000003828000000, 0x0000005070000000, 0x0000006020600000, 
    0x0000006040600000, 0x0000007050000000, 0x000000a0e0000000, 0x000000c040c00000, 
    0x000000c080c00000, 0x000000e0a0000000, 0x0000060206000000, 0x0000060406000000, 
    0x00000a0e00000000, 0x00000c040c000000, 0x00000c080c000000, 0x00000e0a00000000, 
    0x0000141c00000000, 0x0000180818000000, 0x0000181018000000, 0x00001c1400000000, 
    0x0000283800000000, 0x0000301030000000, 0x0000302030000000, 0x0000382800000000, 
    0x0000507000000000, 0x0000602060000000, 0x0000604060000000, 0x0000705000000000, 
    0x0000a0e000000000, 0x0000c040c0000000, 0x0000c080c0000000, 0x0000e0a000000000, 
    0x0006020600000000, 0x0006040600000000, 0x000a0e0000000000, 0x000c040c00000000, 
    0x000c080c00000000, 0x000e0a0000000000, 0x00141c0000000000, 0x0018081800000000, 
    0x0018101800000000, 0x001c140000000000, 0x0028380000000000, 0x0030103000000000, 
    0x0030203000000000, 0x0038280000000000, 0x0050700000000000, 0x0060206000000000, 
    0x0060406000000000, 0x0070500000000000, 0x00a0e00000000000, 0x00c040c000000000, 
    0x00c080c000000000, 0x00e0a00000000000, 0x0602060000000000, 0x0604060000000000, 
    0x0a0e000000000000, 0x0c040c0000000000, 0x0c080c0000000000, 0x0e0a000000000000, 
    0x141c000000000000, 0x1808180000000000, 0x1810180000000000, 0x1c14000000000000, 
    0x2838000000000000, 0x3010300000000000, 0x3020300000000000, 0x3828000000000000, 
    0x5070000000000000, 0x6020600000000000, 0x6040600000000000, 0x7050000000000000, 
    0xa0e0000000000000, 0xc040c00000000000, 0xc080c00000000000, 0xe0a0000000000000, 
    0x0000000002020e00, 0x0000000004041c00, 0x0000000008080e00, 0x0000000008083800, 
    0x000000000e020200, 0x000000000e080800, 0x0000000010101c00, 0x0000000010107000, 
    0x000000001c040400, 0x000000001c101000, 0x0000000020203800, 0x000000002020e000, 
    0x0000000038080800, 0x0000000038202000, 0x0000000040407000, 0x0000000070101000, 
    0x0000000070404000, 0x000000008080e000, 0x00000000e0202000, 0x00000000e0808000, 
    0x00000002020e0000, 0x00000004041c0000, 0x00000008080e0000, 0x0000000808380000, 
    0x0000000e02020000, 0x0000000e08080000, 0x00000010101c0000, 0x0000001010700000, 
    0x0000001c04040000, 0x0000001c10100000, 0x0000002020380000, 0x0000002020e00000, 
    0x0000003808080000, 0x0000003820200000, 0x0000004040700000, 0x0000007010100000, 
    0x0000007040400000, 0x0000008080e00000, 0x000000e020200000, 0x000000e080800000, 
    0x000002020e000000, 0x000004041c000000, 0x000008080e000000, 0x0000080838000000, 
    0x00000e0202000000, 0x00000e0808000000, 0x000010101c000000, 0x0000101070000000, 
    0x00001c0404000000, 0x00001c1010000000, 0x0000202038000000, 0x00002020e0000000, 
    0x0000380808000000, 0x0000382020000000, 0x0000404070000000, 0x0000701010000000, 
    0x0000704040000000, 0x00008080e0000000, 0x0000e02020000000, 0x0000e08080000000, 
    0x0002020e00000000, 0x0004041c00000000, 0x0008080e00000000, 0x0008083800000000, 
    0x000e020200000000, 0x000e080800000000, 0x0010101c00000000, 0x0010107000000000, 
    0x001c040400000000, 0x001c101000000000, 0x0020203800000000, 0x002020e000000000, 
    0x0038080800000000, 0x0038202000000000, 0x0040407000000000, 0x0070101000000000, 
    0x0070404000000000, 0x008080e000000000, 0x00e0202000000000, 0x00e0808000000000, 
    0x02020e0000000000, 0x04041c0000000000, 0x08080e0000000000, 0x0808380000000000, 
    0x0e02020000000000, 0x0e08080000000000, 0x10101c0000000000, 0x1010700000000000, 
    0x1c04040000000000, 0x1c10100000000000, 0x2020380000000000, 0x2020e00000000000, 
    0x3808080000000000, 0x3820200000000000, 0x4040700000000000, 0x7010100000000000, 
    0x7040400000000000, 0x8080e00000000000, 0xe020200000000000, 0xe080800000000000, 
    0x0000000000041e00, 0x0000000000081e00, 0x0000000000083c00, 0x0000000000103c00, 
    0x0000000000107800, 0x00000000001e0400, 0x00000000001e0800, 0x0000000000207800, 
    0x000000000020f000, 0x00000000003c0800, 0x00000000003c1000, 0x000000000040f000, 
    0x0000000000781000, 0x0000000000782000, 0x0000000000f02000, 0x0000000000f04000, 
    0x00000000041e0000, 0x00000000081e0000, 0x00000000083c0000, 0x00000000103c0000, 
    0x0000000010780000, 0x000000001e040000, 0x000000001e080000, 0x0000000020780000, 
    0x0000000020f00000, 0x000000003c080000, 0x000000003c100000, 0x0000000040f00000, 
    0x0000000078100000, 0x0000000078200000, 0x00000000f0200000, 0x00000000f0400000, 
    0x0000000202060200, 0x0000000206020200, 0x0000000404060400, 0x00000004040c0400, 
    0x0000000406040400, 0x000000040c040400, 0x000000041e000000, 0x00000008080c0800, 
    0x0000000808180800, 0x000000080c080800, 0x0000000818080800, 0x000000081e000000, 
    0x000000083c000000, 0x0000001010181000, 0x0000001010301000, 0x0000001018101000, 
    0x0000001030101000, 0x000000103c000000, 0x0000001078000000, 0x0000001e04000000, 
    0x0000001e08000000, 0x0000002020302000, 0x0000002020602000, 0x0000002030202000, 
    0x0000002060202000, 0x0000002078000000, 0x00000020f0000000, 0x0000003c08000000, 
    0x0000003c10000000, 0x0000004040604000, 0x0000004040c04000, 0x0000004060404000, 
    0x00000040c0404000, 0x00000040f0000000, 0x0000007810000000, 0x0000007820000000, 
    0x0000008080c08000, 0x00000080c0808000, 0x000000f020000000, 0x000000f040000000, 
    0x0000020206020000, 0x0000020602020000, 0x0000040406040000, 0x000004040c040000, 
    0x0000040604040000, 0x0000040c04040000, 0x0000041e00000000, 0x000008080c080000, 
    0x0000080818080000, 0x0000080c08080000, 0x0000081808080000, 0x0000081e00000000, 
    0x0000083c00000000, 0x0000101018100000, 0x0000101030100000, 0x0000101810100000, 
    0x0000103010100000, 0x0000103c00000000, 0x0000107800000000, 0x00001e0400000000, 
    0x00001e0800000000, 0x0000202030200000, 0x0000202060200000, 0x0000203020200000, 
    0x0000206020200000, 0x0000207800000000, 0x000020f000000000, 0x00003c0800000000, 
    0x00003c1000000000, 0x0000404060400000, 0x00004040c0400000, 0x0000406040400000, 
    0x000040c040400000, 0x000040f000000000, 0x0000781000000000, 0x0000782000000000, 
    0x00008080c0800000, 0x000080c080800000, 0x0000f02000000000, 0x0000f04000000000, 
    0x0002020602000000, 0x0002060202000000, 0x0004040604000000, 0x0004040c04000000, 
    0x0004060404000000, 0x00040c0404000000, 0x00041e0000000000, 0x0008080c08000000, 
    0x0008081808000000, 0x00080c0808000000, 0x0008180808000000, 0x00081e0000000000, 
    0x00083c0000000000, 0x0010101810000000, 0x0010103010000000, 0x0010181010000000, 
    0x0010301010000000, 0x00103c0000000000, 0x0010780000000000, 0x001e040000000000, 
    0x001e080000000000, 0x0020203020000000, 0x0020206020000000, 0x0020302020000000, 
    0x0020602020000000, 0x0020780000000000, 0x0020f00000000000, 0x003c080000000000, 
    0x003c100000000000, 0x0040406040000000, 0x004040c040000000, 0x0040604040000000, 
    0x0040c04040000000, 0x0040f00000000000, 0x0078100000000000, 0x0078200000000000, 
    0x008080c080000000, 0x0080c08080000000, 0x00f0200000000000, 0x00f0400000000000, 
    0x0202060200000000, 0x0206020200000000, 0x0404060400000000, 0x04040c0400000000, 
    0x0406040400000000, 0x040c040400000000, 0x041e000000000000, 0x08080c0800000000, 
    0x0808180800000000, 0x080c080800000000, 0x0818080800000000, 0x081e000000000000, 
    0x083c000000000000, 0x1010181000000000, 0x1010301000000000, 0x1018101000000000, 
    0x1030101000000000, 0x103c000000000000, 0x1078000000000000, 0x1e04000000000000, 
    0x1e08000000000000, 0x2020302000000000, 0x2020602000000000, 0x2030202000000000, 
    0x2060202000000000, 0x2078000000000000, 0x20f0000000000000, 0x3c08000000000000, 
    0x3c10000000000000, 0x4040604000000000, 0x4040c04000000000, 0x4060404000000000, 
    0x40c0404000000000, 0x40f0000000000000, 0x7810000000000000, 0x7820000000000000, 
    0x8080c08000000000, 0x80c0808000000000, 0xf020000000000000, 0xf040000000000000, 
    0x0000000000021e00, 0x0000000000043c00, 0x0000000000087800, 0x0000000000101e00, 
    0x000000000010f000, 0x00000000001e0200, 0x00000000001e1000, 0x0000000000203c00, 
    0x00000000003c0400, 0x00000000003c2000, 0x0000000000407800, 0x0000000000780800, 
    0x0000000000784000, 0x000000000080f000, 0x0000000000f01000, 0x0000000000f08000, 
    0x00000000021e0000, 0x00000000043c0000, 0x0000000008780000, 0x00000000101e0000, 
    0x0000000010f00000, 0x000000001e020000, 0x000000001e100000, 0x00000000203c0000, 
    0x000000003c040000, 0x000000003c200000, 0x0000000040780000, 0x0000000078080000, 
    0x0000000078400000, 0x0000000080f00000, 0x00000000f0100000, 0x00000000f0800000, 
    0x0000000202020600, 0x000000021e000000, 0x0000000404040600, 0x0000000404040c00, 
    0x000000043c000000, 0x0000000602020200, 0x0000000604040400, 0x0000000808080c00, 
    0x0000000808081800, 0x0000000878000000, 0x0000000c04040400, 0x0000000c08080800, 
    0x0000001010101800, 0x0000001010103000, 0x000000101e000000, 0x00000010f0000000, 
    0x0000001808080800, 0x0000001810101000, 0x0000001e02000000, 0x0000001e10000000, 
    0x0000002020203000, 0x0000002020206000, 0x000000203c000000, 0x0000003010101000, 
    0x0000003020202000, 0x0000003c04000000, 0x0000003c20000000, 0x0000004040406000, 
    0x000000404040c000, 0x0000004078000000, 0x0000006020202000, 0x0000006040404000, 
    0x0000007808000000, 0x0000007840000000, 0x000000808080c000, 0x00000080f0000000, 
    0x000000c040404000, 0x000000c080808000, 0x000000f010000000, 0x000000f080000000, 
    0x0000020202060000, 0x0000021e00000000, 0x0000040404060000, 0x00000404040c0000, 
    0x0000043c00000000, 0x0000060202020000, 0x0000060404040000, 0x00000808080c0000, 
    0x0000080808180000, 0x0000087800000000, 0x00000c0404040000, 0x00000c0808080000, 
    0x0000101010180000, 0x0000101010300000, 0x0000101e00000000, 0x000010f000000000, 
    0x0000180808080000, 0x0000181010100000, 0x00001e0200000000, 0x00001e1000000000, 
    0x0000202020300000, 0x0000202020600000, 0x0000203c00000000, 0x0000301010100000, 
    0x0000302020200000, 0x00003c0400000000, 0x00003c2000000000, 0x0000404040600000, 
    0x0000404040c00000, 0x0000407800000000, 0x0000602020200000, 0x0000604040400000, 
    0x0000780800000000, 0x0000784000000000, 0x0000808080c00000, 0x000080f000000000, 
    0x0000c04040400000, 0x0000c08080800000, 0x0000f01000000000, 0x0000f08000000000, 
    0x0002020206000000, 0x00021e0000000000, 0x0004040406000000, 0x000404040c000000, 
    0x00043c0000000000, 0x0006020202000000, 0x0006040404000000, 0x000808080c000000, 
    0x0008080818000000, 0x0008780000000000, 0x000c040404000000, 0x000c080808000000, 
    0x0010101018000000, 0x0010101030000000, 0x00101e0000000000, 0x0010f00000000000, 
    0x0018080808000000, 0x0018101010000000, 0x001e020000000000, 0x001e100000000000, 
    0x0020202030000000, 0x0020202060000000, 0x00203c0000000000, 0x0030101010000000, 
    0x0030202020000000, 0x003c040000000000, 0x003c200000000000, 0x0040404060000000, 
    0x00404040c0000000, 0x0040780000000000, 0x0060202020000000, 0x0060404040000000, 
    0x0078080000000000, 0x0078400000000000, 0x00808080c0000000, 0x0080f00000000000, 
    0x00c0404040000000, 0x00c0808080000000, 0x00f0100000000000, 0x00f0800000000000, 
    0x0202020600000000, 0x021e000000000000, 0x0404040600000000, 0x0404040c00000000, 
    0x043c000000000000, 0x0602020200000000, 0x0604040400000000, 0x0808080c00000000, 
    0x0808081800000000, 0x0878000000000000, 0x0c04040400000000, 0x0c08080800000000, 
    0x1010101800000000, 0x1010103000000000, 0x101e000000000000, 0x10f0000000000000, 
    0x1808080800000000, 0x1810101000000000, 0x1e02000000000000, 0x1e10000000000000, 
    0x2020203000000000, 0x2020206000000000, 0x203c000000000000, 0x3010101000000000, 
    0x3020202000000000, 0x3c04000000000000, 0x3c20000000000000, 0x4040406000000000, 
    0x404040c000000000, 0x4078000000000000, 0x6020202000000000, 0x6040404000000000, 
    0x7808000000000000, 0x7840000000000000, 0x808080c000000000, 0x80f0000000000000, 
    0xc040404000000000, 0xc080808000000000, 0xf010000000000000, 0xf080000000000000, 
    0x00000000000e0e00, 0x00000000001c1c00, 0x0000000000383800, 0x0000000000707000, 
    0x0000000000e0e000, 0x0000000006060600, 0x000000000c0c0c00, 0x000000000e0e0000, 
    0x0000000018181800, 0x000000001c1c0000, 0x0000000030303000, 0x0000000038380000, 
    0x0000000060606000, 0x0000000070700000, 0x00000000c0c0c000, 0x00000000e0e00000, 
    0x0000000606060000, 0x0000000c0c0c0000, 0x0000000e0e000000, 0x0000001818180000, 
    0x0000001c1c000000, 0x0000003030300000, 0x0000003838000000, 0x0000006060600000, 
    0x0000007070000000, 0x000000c0c0c00000, 0x000000e0e0000000, 0x0000060606000000, 
    0x00000c0c0c000000, 0x00000e0e00000000, 0x0000181818000000, 0x00001c1c00000000, 
    0x0000303030000000, 0x0000383800000000, 0x0000606060000000, 0x0000707000000000, 
    0x0000c0c0c0000000, 0x0000e0e000000000, 0x0006060600000000, 0x000c0c0c00000000, 
    0x000e0e0000000000, 0x0018181800000000, 0x001c1c0000000000, 0x0030303000000000, 
    0x0038380000000000, 0x0060606000000000, 0x0070700000000000, 0x00c0c0c000000000, 
    0x00e0e00000000000, 0x0606060000000000, 0x0c0c0c0000000000, 0x0e0e000000000000, 
    0x1818180000000000, 0x1c1c000000000000, 0x3030300000000000, 0x3838000000000000, 
    0x6060600000000000, 0x7070000000000000, 0xc0c0c00000000000, 0xe0e0000000000000, 
    0x0000000000060e00, 0x00000000000c0e00, 0x00000000000c1c00, 0x00000000000e0600, 
    0x00000000000e0c00, 0x0000000000181c00, 0x0000000000183800, 0x00000000001c0c00, 
    0x00000000001c1800, 0x0000000000303800, 0x0000000000307000, 0x0000000000381800, 
    0x0000000000383000, 0x0000000000607000, 0x000000000060e000, 0x0000000000703000, 
    0x0000000000706000, 0x0000000000c0e000, 0x0000000000e06000, 0x0000000000e0c000, 
    0x0000000002060600, 0x0000000004060600, 0x00000000040c0c00, 0x0000000006060200, 
    0x0000000006060400, 0x00000000060e0000, 0x00000000080c0c00, 0x0000000008181800, 
    0x000000000c0c0400, 0x000000000c0c0800, 0x000000000c0e0000, 0x000000000c1c0000, 
    0x000000000e060000, 0x000000000e0c0000, 0x0000000010181800, 0x0000000010303000, 
    0x0000000018180800, 0x0000000018181000, 0x00000000181c0000, 0x0000000018380000, 
    0x000000001c0c0000, 0x000000001c180000, 0x0000000020303000, 0x0000000020606000, 
    0x0000000030301000, 0x0000000030302000, 0x0000000030380000, 0x0000000030700000, 
    0x0000000038180000, 0x0000000038300000, 0x0000000040606000, 0x0000000040c0c000, 
    0x0000000060602000, 0x0000000060604000, 0x0000000060700000, 0x0000000060e00000, 
    0x0000000070300000, 0x0000000070600000, 0x0000000080c0c000, 0x00000000c0c04000, 
    0x00000000c0c08000, 0x00000000c0e00000, 0x00000000e0600000, 0x00000000e0c00000, 
    0x0000000206060000, 0x0000000406060000, 0x000000040c0c0000, 0x0000000606020000, 
    0x0000000606040000, 0x000000060e000000, 0x000000080c0c0000, 0x0000000818180000, 
    0x0000000c0c040000, 0x0000000c0c080000, 0x0000000c0e000000, 0x0000000c1c000000, 
    0x0000000e06000000, 0x0000000e0c000000, 0x0000001018180000, 0x0000001030300000, 
    0x0000001818080000, 0x0000001818100000, 0x000000181c000000, 0x0000001838000000, 
    0x0000001c0c000000, 0x0000001c18000000, 0x0000002030300000, 0x0000002060600000, 
    0x0000003030100000, 0x0000003030200000, 0x0000003038000000, 0x0000003070000000, 
    0x0000003818000000, 0x0000003830000000, 0x0000004060600000, 0x00000040c0c00000, 
    0x0000006060200000, 0x0000006060400000, 0x0000006070000000, 0x00000060e0000000, 
    0x0000007030000000, 0x0000007060000000, 0x00000080c0c00000, 0x000000c0c0400000, 
    0x000000c0c0800000, 0x000000c0e0000000, 0x000000e060000000, 0x000000e0c0000000, 
    0x0000020606000000, 0x0000040606000000, 0x0000040c0c000000, 0x0000060602000000, 
    0x0000060604000000, 0x0000060e00000000, 0x0000080c0c000000, 0x0000081818000000, 
    0x00000c0c04000000, 0x00000c0c08000000, 0x00000c0e00000000, 0x00000c1c00000000, 
    0x00000e0600000000, 0x00000e0c00000000, 0x0000101818000000, 0x0000103030000000, 
    0x0000181808000000, 0x0000181810000000, 0x0000181c00000000, 0x0000183800000000, 
    0x00001c0c00000000, 0x00001c1800000000, 0x0000203030000000, 0x0000206060000000, 
    0x0000303010000000, 0x0000303020000000, 0x0000303800000000, 0x0000307000000000, 
    0x0000381800000000, 0x0000383000000000, 0x0000406060000000, 0x000040c0c0000000, 
    0x0000606020000000, 0x0000606040000000, 0x0000607000000000, 0x000060e000000000, 
    0x0000703000000000, 0x0000706000000000, 0x000080c0c0000000, 0x0000c0c040000000, 
    0x0000c0c080000000, 0x0000c0e000000000, 0x0000e06000000000, 0x0000e0c000000000, 
    0x0002060600000000, 0x0004060600000000, 0x00040c0c00000000, 0x0006060200000000, 
    0x0006060400000000, 0x00060e0000000000, 0x00080c0c00000000, 0x0008181800000000, 
    0x000c0c0400000000, 0x000c0c0800000000, 0x000c0e0000000000, 0x000c1c0000000000, 
    0x000e060000000000, 0x000e0c0000000000, 0x0010181800000000, 0x0010303000000000, 
    0x0018180800000000, 0x0018181000000000, 0x00181c0000000000, 0x0018380000000000, 
    0x001c0c0000000000, 0x001c180000000000, 0x0020303000000000, 0x0020606000000000, 
    0x0030301000000000, 0x0030302000000000, 0x0030380000000000, 0x0030700000000000, 
    0x0038180000000000, 0x0038300000000000, 0x0040606000000000, 0x0040c0c000000000, 
    0x0060602000000000, 0x0060604000000000, 0x0060700000000000, 0x0060e00000000000, 
    0x0070300000000000, 0x0070600000000000, 0x0080c0c000000000, 0x00c0c04000000000, 
    0x00c0c08000000000, 0x00c0e00000000000, 0x00e0600000000000, 0x00e0c00000000000, 
    0x0206060000000000, 0x0406060000000000, 0x040c0c0000000000, 0x0606020000000000, 
    0x0606040000000000, 0x060e000000000000, 0x080c0c0000000000, 0x0818180000000000, 
    0x0c0c040000000000, 0x0c0c080000000000, 0x0c0e000000000000, 0x0c1c000000000000, 
    0x0e06000000000000, 0x0e0c000000000000, 0x1018180000000000, 0x1030300000000000, 
    0x1818080000000000, 0x1818100000000000, 0x181c000000000000, 0x1838000000000000, 
    0x1c0c000000000000, 0x1c18000000000000, 0x2030300000000000, 0x2060600000000000, 
    0x3030100000000000, 0x3030200000000000, 0x3038000000000000, 0x3070000000000000, 
    0x3818000000000000, 0x3830000000000000, 0x4060600000000000, 0x40c0c00000000000, 
    0x6060200000000000, 0x6060400000000000, 0x6070000000000000, 0x60e0000000000000, 
    0x7030000000000000, 0x7060000000000000, 0x80c0c00000000000, 0xc0c0400000000000, 
    0xc0c0800000000000, 0xc0e0000000000000, 0xe060000000000000, 0xe0c0000000000000 
};

// To be implemented
// #define MAX_SOLUTIONS_COUNT 1024
// struct solution_t solutions[MAX_SOLUTIONS_COUNT];

int num_solutions; /* 発見した数 */


/* 盤面 board に対して次のセルを選んで、その bit の値を返す */
inline uint64_t next_cell_bit(uint64_t board) {
#ifdef UNROLL_MAT2BIN_LUT
    for (int i = 0; i < 49; i++) {
        uint64_t done = board & mat2bin_lut[i];
        if (! done)
            return mat2bin_lut[i];
    }
#else
    for (int y = 0 ; y < 7; y++)
        for (int x = 0 ;x < 7; x++) {
            uint64_t done = board & mat2bin_lut[y][x];
            if (! done)
                return mat2bin_lut[y][x];
        }
#endif
    return 0;
}


/* シングルステップ */
void step(struct solution_t *sol) {
    for (int shape_id = 0; shape_id < NUM_SHAPES; shape_id++) {
        if (sol->blocks_used & (1 << shape_id))
            continue;

        int shape_offset = block_shape_meta[shape_id].offset;
        int shape_count  = block_shape_meta[shape_id].count;

        struct solution_t child_sol;

        uint64_t next_cell = next_cell_bit(sol->board);

        for (int block_id = shape_offset; block_id < shape_offset + shape_count; block_id++) {
            uint64_t block = block_shape_lut[block_id];

            if ((block & next_cell) == 0) // 目標のセルが埋まらない候補
                continue;

            if (sol->board & block) // 既存ブロックとの衝突
                continue;

            for (int i = 0; i < sol->blocks; i++)
                child_sol.block_masks_list[i] = sol->block_masks_list[i];

            child_sol.block_masks_list[sol->blocks] = block;
            child_sol.blocks = sol->blocks + 1;
            child_sol.board = sol->board | block;
            child_sol.blocks_used = sol->blocks_used | (1 << shape_id);

            if (child_sol.blocks_used == 0xFF) { // 全てのブロックを見つけた
#if 0
                printf("solution found: %x %lx [", child_sol.blocks_used, child_sol.board);
                for (int i = 0; i < child_sol.blocks; i++)
                    printf("0x%lx, ",child_sol.block_masks_list[i]);
                printf("\n");
#endif
                num_solutions += 1;
                break;
            }

            step(&child_sol);
        }
    }
}


int run_once() {
    struct solution_t sol_data = {
        .board = 144678138029284864 | 288239172244733952,
        .blocks = 2,
        .blocks_used = 0,
        .block_masks_list = {
            144678138029284864,    /* static constraint */
            288239172244733952,    /* YY/DD constraint (hardcoded) */
            0, 0, 0, 0, 0, 0, 0, 0 /* board pieces */
        }
    };
    num_solutions = 0;

    step(&sol_data);
}


int main() {
    run_once();
    printf("%d solutions found\n", num_solutions);
}
